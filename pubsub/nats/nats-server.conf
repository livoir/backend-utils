# NATS Server Configuration File

# Server settings
server_name: nats-server
listen: 0.0.0.0:4222
http_port: 8222

# Logging
debug: false
trace: false
logtime: true

# JetStream configuration (persistent messaging)
jetstream {
    store_dir: "/data/jetstream"
    max_memory_store: 1GB
    max_file_store: 10GB
}

# Monitoring and health
http: 8222

# Client connection limits
max_connections: 1000
max_payload: 1MB

# Authentication and Authorization
accounts {
  # System account for server monitoring and management
  SYS {
    users = [
      { 
        user: "admin"
        password: "admin123"
        permissions: {
          publish: {
            allow: [">"]
          }
          subscribe: {
            allow: [">"]
          }
        }
      }
    ]
  }
  
  # Application account for regular services
  APP {
    users = [
      { 
        user: "backend-service"
        password: "backend123"
        permissions: {
          publish: {
            allow: [">"]
            # allow: ["events.>", "commands.>", "requests.>", "logs.>"]
            # deny: ["system.>", "admin.>"]
          }
          subscribe: {
            allow: [">"]
            # allow: ["events.>", "responses.>", "notifications.>", "commands.>"]
            # deny: ["system.>", "admin.>"]
          }
        }
      },
      { 
        user: "web-service"
        password: "web123"
        permissions: {
          publish: {
            allow: ["requests.>", "user.actions.>", "notifications.>"]
            deny: ["system.>", "admin.>", "commands.>", "events.internal.>"]
          }
          subscribe: {
            allow: ["responses.>", "notifications.user.>", "events.user.>"]
            deny: ["system.>", "admin.>", "events.internal.>"]
          }
        }
      },
      { 
        user: "analytics-service"
        password: "analytics123"
        permissions: {
          publish: {
            allow: ["analytics.>", "metrics.>"]
            deny: ["system.>", "admin.>"]
          }
          subscribe: {
            allow: ["events.>", "user.>", "logs.>"]
            deny: ["system.>", "admin.>", "commands.>"]
          }
        }
      }
    ]
    jetstream: enabled
  }
}

# Cluster configuration (for multi-node setup)
# cluster {
#     name: nats-cluster
#     listen: 0.0.0.0:6222
# }

# System account for monitoring
system_account: "SYS"

# Max pending data per client
max_pending: 64MB

# Slow consumer settings
write_deadline: "2s"
